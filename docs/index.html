<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Radar Chart with Dynamic Categories</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
    h2 { text-align: center; }
    .controls { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
    .control {
      display: flex;
      align-items: center;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #fafafa;
    }
    .control.drag-over { background: #e0f7fa; }
    .control input[type="text"] { width: 140px; margin-right: 10px; }
    .control input[type="range"] { flex: 1; margin-right: 10px; }
    .control span { width: 20px; text-align: right; margin-right: 10px; }
    .control .remove-btn {
      background: #e53935;
      color: white;
      border: none;
      border-radius: 4px;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }
    #addBtn, #exportBtn {
      margin-top: 10px;
      padding: 8px 12px;
      border: 1px solid #007bff;
      background: #007bff;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
    #colorPicker { margin-top: 10px; display: flex; align-items: center; gap: 10px; }
    #profileLink { text-align: center; margin: 10px 0; display: flex; align-items: center; justify-content: center; gap: 8px; }
    #profileLink img { width: 40px; height: 40px; border-radius: 50%; }
    #profileLink a { color: #0073b1; text-decoration: none; font-weight: bold; }
  </style>
</head>
<body>
  <h2>What kind of data person are you?</h2>
  <canvas id="radarChart"></canvas>
  <!-- LinkedIn Profile -->
  <div id="profileLink">
    <img src="https://media.licdn.com/dms/image/v2/D4E03AQFMTI68hC15NA/profile-displayphoto-shrink_400_400/B4EZRLw2SJGcAo-/0/1736437884358?e=1752105600&v=beta&t=HhQDfXVmgY0qBGrW5C_yBiM-VCuMsCEbPNbq3ZhyTto" alt="LinkedIn Profile Photo" />
    <a href="https://www.linkedin.com/in/ddirring/" target="_blank" rel="noopener">https://www.linkedin.com/in/ddirring/</a>
  </div>
  <div class="controls" id="controls"></div>
  <button id="addBtn">Add Category</button>
  <button id="exportBtn">Export Chart as Image</button>
  <div id="colorPicker">
    <label for="colorInput">Choose chart color:</label>
    <input type="color" id="colorInput" value="#36A2EB">
  </div>

  <script>
    // Plugin to draw white background behind the chart
    Chart.register({
      id: 'whiteBackground',
      beforeDraw(chart) {
        const ctx = chart.ctx;
        ctx.save();
        ctx.globalCompositeOperation = 'destination-over';
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, chart.width, chart.height);
        ctx.restore();
      }
    });

    // Initial defaults
    const defaultLabels = ["SQL & Data Wrangling", "Data Viz & Storytelling", "Statistics", "Business Acumen", "Communication", "Python", "Data Engineering", "Experimentation / Testing", "ML Awareness", "ML Ops"];
    const defaultData = [2, 2, 2, 2, 2];

    // Initialize Chart.js
    const ctx = document.getElementById('radarChart').getContext('2d');
    const radarChart = new Chart(ctx, {
      type: 'radar',
      data: {
        labels: [],
        datasets: [{
          data: [],
          backgroundColor: 'rgba(54,162,235,0.2)',
          borderColor: '#36A2EB',
          borderWidth: 2
        }]
      },
      options: {
        scales: {
          r: {
            min: 0,
            max: 10,
            ticks: { stepSize: 1 },
            pointLabels: {
              font: { size: 14, weight: 'bold' }
            }
          }
        },
        plugins: {
          whiteBackground: true,
          legend: { display: false }
        }
      }
    });

    const controlsDiv = document.getElementById('controls');
    let draggedControl = null;

    // Utility to convert hex to rgba
    function hexToRgba(hex, alpha) {
      const r = parseInt(hex.slice(1,3),16),
            g = parseInt(hex.slice(3,5),16),
            b = parseInt(hex.slice(5,7),16);
      return `rgba(${r},${g},${b},${alpha})`;
    }

    // Create control row
    function createControl(label = 'New Category', value = 2) {
      const control = document.createElement('div');
      control.className = 'control';
      control.setAttribute('draggable', true);

      // Drag & Drop handlers
      control.addEventListener('dragstart', e => { draggedControl = control; e.dataTransfer.effectAllowed = 'move'; e.dataTransfer.setData('text/plain',''); });
      control.addEventListener('dragover', e => { e.preventDefault(); control.classList.add('drag-over'); });
      control.addEventListener('dragenter', e => { e.preventDefault(); control.classList.add('drag-over'); });
      control.addEventListener('dragleave', () => { control.classList.remove('drag-over'); });
      control.addEventListener('drop', e => { e.preventDefault(); control.classList.remove('drag-over'); if (draggedControl && draggedControl !== control) { controlsDiv.insertBefore(draggedControl, control); updateChart(); }});
      control.addEventListener('dragend', () => { document.querySelectorAll('.control').forEach(c => c.classList.remove('drag-over')); draggedControl = null; });

      // Name input
      const nameInput = document.createElement('input');
      nameInput.type = 'text';
      nameInput.value = label;
      nameInput.addEventListener('input', updateChart);

      // Value slider
      const rangeInput = document.createElement('input');
      rangeInput.type = 'range';
      rangeInput.min = 0;
      rangeInput.max = 10;
      rangeInput.value = value;
      rangeInput.addEventListener('input', () => { valueSpan.textContent = rangeInput.value; updateChart(); });

      const valueSpan = document.createElement('span');
      valueSpan.textContent = value;

      // Remove button
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = 'Ã—';
      removeBtn.addEventListener('click', () => { control.remove(); updateChart(); });

      control.append(nameInput, rangeInput, valueSpan, removeBtn);
      controlsDiv.appendChild(control);
      updateChart();
    }

    // Load defaults
    defaultLabels.forEach((lab, i) => createControl(lab, defaultData[i]));

    // Add category button
    document.getElementById('addBtn').addEventListener('click', () => createControl());

    // Export chart as image
    document.getElementById('exportBtn').addEventListener('click', () => {
      const link = document.createElement('a');
      link.href = radarChart.toBase64Image();
      link.download = 'radar-chart.png';
      link.click();
    });

    // Color picker
    document.getElementById('colorInput').addEventListener('input', e => {
      const hex = e.target.value;
      radarChart.data.datasets[0].backgroundColor = hexToRgba(hex, 0.2);
      radarChart.data.datasets[0].borderColor = hex;
      radarChart.update();
    });

    // Update chart with proper multiline labels
    function updateChart() {
      const labels = [];
      const data = [];
      document.querySelectorAll('.control').forEach(ctrl => {
        const raw = ctrl.querySelector('input[type="text"]').value.trim();
        const wrapped = raw.split(/\s+/).join('\n');
        labels.push(wrapped);
        data.push(+ctrl.querySelector('input[type="range"]').value);
      });
      radarChart.data.labels = labels;
      radarChart.data.datasets[0].data = data;
      radarChart.update();
    }
  </script>
</body>
</html>
